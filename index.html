<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Crop Yield Predictor</title>
  <link rel="stylesheet" href="style.css"/>
  <style>
    .footer {
      text-align: center;
      padding: 15px;
      background-color: #f2f2f2;
      color: #333;
      font-size: 14px;
      margin-top: 40px;
      border-top: 1px solid #ccc;
    }

    .mic-command-btn {
      display: block;
      margin: 20px auto 10px;
      padding: 10px 20px;
      background-color: #007bff;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .mic-command-btn:hover {
      background-color: #0056b3;
    }

    form label {
      display: block;
      margin-bottom: 15px;
    }

    #result {
      margin-top: 20px;
      font-weight: bold;
      text-align: center;
    }
  </style>
</head>

<body>
  <div style="text-align: right; padding: 10px;">
    <label for="lang">ЁЯМР Language:</label>
    <select id="lang">
      <option value="en">English</option>
      <option value="ta">родрооро┐ро┤рпН</option>
      <option value="hi">рд╣рд┐рдиреНрджреА</option>
    </select>
  </div>

  <div class="container">
    <h1>ЁЯМ╛ Smart Crop Yield Predictor</h1>
    <form id="cropForm">
      <label>Soil pH:
        <input type="number" name="soil_ph" step="0.1" />
      </label>

      <label>Rainfall (mm):
        <input type="number" name="rainfall" />
      </label>

      <label>Temperature (┬░C):
        <input type="number" name="temperature" />
      </label>

      <label>Fertilizer Type:
        <input type="text" name="fertilizer" />
      </label>

      <label>Yield (quintals/hectare):
        <input type="number" name="yield" />
      </label>

      <button type="submit">Predict Yield</button>
      <button type="button" class="mic-command-btn" onclick="startVoiceCommand()">ЁЯОЩя╕П Voice Command</button>
    </form>
    <div id="result"></div>
  </div>

  <div class="footer">Developed by Sanjay Panneerselvan</div>

  <script>
    const translations = {
      en: {
        title: "Smart Crop Yield Predictor",
        soilPH: "Soil pH",
        rainfall: "Rainfall (mm)",
        temperature: "Temperature (┬░C)",
        fertilizer: "Fertilizer Type",
        yield: "Yield (quintals/hectare)",
        button: "Predict Yield",
        resultLabel: "Predicted Yield:"
      },
      ta: {
        title: "роЪро╛рооро░рпНродрпНродро┐ропрооро╛рой рокропро┐ро░рпН роороХроЪрпВро▓рпН роХрогро┐рокрпНрокро╛ро│ро░рпН",
        soilPH: "роорогрпН pH",
        rainfall: "рооро┤рпИ роЕро│ро╡рпБ (рооро┐роорпА)",
        temperature: "ро╡рпЖрокрпНрокроиро┐ро▓рпИ (┬░C)",
        fertilizer: "роЙро░ ро╡роХрпИ",
        yield: "роороХроЪрпВро▓рпН (ро╣рпЖроХрпНроЯрпЗро░рпБроХрпНроХрпБ роХрпБро╡ро┐ройрпНроЯро▓рпНроХро│рпН)",
        button: "роороХроЪрпВро▓рпИ роХрогро┐роХрпНроХро╡рпБроорпН",
        resultLabel: "роХрогро┐роХрпНроХрокрпНрокроЯрпНроЯ роороХроЪрпВро▓рпН:"
      },
      hi: {
        title: "рд╕реНрдорд╛рд░реНрдЯ рдлрд╕рд▓ рдЙрдкрдЬ рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рди",
        soilPH: "рдорд┐рдЯреНрдЯреА рдХрд╛ pH",
        rainfall: "рд╡рд░реНрд╖рд╛ (рдорд┐рдореА)",
        temperature: "рддрд╛рдкрдорд╛рди (┬░C)",
        fertilizer: "рдЙрд░реНрд╡рд░рдХ рдкреНрд░рдХрд╛рд░",
        yield: "рдЙрдкрдЬ (рдХреНрд╡рд┐рдВрдЯрд▓/рд╣реЗрдХреНрдЯреЗрдпрд░)",
        button: "рдЙрдкрдЬ рдХрд╛ рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рди рд▓рдЧрд╛рдПрдВ",
        resultLabel: "рдЕрдиреБрдорд╛рдирд┐рдд рдЙрдкрдЬ:"
      }
    };

    const fieldMap = {
      en: {
        'soil ph': 'soil_ph',
        'rainfall': 'rainfall',
        'temperature': 'temperature',
        'fertilizer': 'fertilizer',
        'yield': 'yield'
      },
      ta: {
        'роорогрпН рокро┐ро╣рпЖроЪрпН': 'soil_ph',
        'рооро┤рпИ': 'rainfall',
        'ро╡рпЖрокрпНрокроиро┐ро▓рпИ': 'temperature',
        'роЙро░ ро╡роХрпИ': 'fertilizer',
        'роороХроЪрпВро▓рпН': 'yield'
      },
      hi: {
        'рдорд┐рдЯреНрдЯреА': 'soil_ph',
        'рд╡рд░реНрд╖рд╛': 'rainfall',
        'рддрд╛рдкрдорд╛рди': 'temperature',
        'рдЙрд░реНрд╡рд░рдХ': 'fertilizer',
        'рдЙрдкрдЬ': 'yield'
      }
    };

    function translate(lang) {
      const t = translations[lang];
      document.querySelector("h1").innerText = t.title;
      const labels = document.querySelectorAll("form label");
      labels[0].childNodes[0].nodeValue = t.soilPH + ": ";
      labels[1].childNodes[0].nodeValue = t.rainfall + ": ";
      labels[2].childNodes[0].nodeValue = t.temperature + ": ";
      labels[3].childNodes[0].nodeValue = t.fertilizer + ": ";
      labels[4].childNodes[0].nodeValue = t.yield + ": ";
      document.querySelector("button[type='submit']").innerText = t.button;
    }

    document.getElementById("lang").addEventListener("change", function () {
      translate(this.value);
    });

    function speak(text, lang = 'en-IN') {
      const synth = window.speechSynthesis;
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = lang;
      synth.speak(utterance);
    }

    function startVoiceCommand() {
      const langCode = document.getElementById("lang").value;
      const lang = (langCode === 'ta') ? 'ta-IN' : (langCode === 'hi') ? 'hi-IN' : 'en-US';
      const map = fieldMap[langCode];

      const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.lang = lang;
      recognition.start();

      recognition.onresult = function (event) {
        const transcript = event.results[0][0].transcript.toLowerCase().trim();

        let matched = false;
        for (const key in map) {
          if (transcript.includes(key)) {
            const value = transcript.replace(key, '').replace(':', '').trim().split(' ')[0];
            const field = map[key];
            const input = document.querySelector(`[name=${field}]`);
            if (input) {
              input.value = value;
              speak(`${key} set to ${value}`, lang);
              matched = true;
              break;
            }
          }
        }

        if (!matched) {
          alert("Couldn't understand. Please speak field name followed by value.");
        }
      };

      recognition.onerror = function (event) {
        alert("Voice command failed: " + event.error);
      };
    }

    document.getElementById('cropForm').addEventListener('submit', async function (e) {
      e.preventDefault();
      const formData = new FormData(this);
      const data = Object.fromEntries(formData);
      const langCode = document.getElementById("lang").value;

      const response = await fetch('http://localhost:5000/predict', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });

      const result = await response.json();
      const predictionText = {
        en: 'Predicted Yield: ' + result.yield + ' quintals per hectare',
        ta: 'роорпБройрпНроХрогро┐роХрпНроХрокрпНрокроЯрпНроЯ роороХроЪрпВро▓рпН: ' + result.yield + ' ро╣рпЖроХрпНроЯрпЗро░рпБроХрпНроХрпБ роХрпБро╡ро┐ройрпНроЯро▓рпНроХро│рпН',
        hi: 'рдЕрдиреБрдорд╛рдирд┐рдд рдЙрдкрдЬ: ' + result.yield + ' рдХреНрд╡рд┐рдВрдЯрд▓ рдкреНрд░рддрд┐ рд╣реЗрдХреНрдЯреЗрдпрд░'
      };

      document.getElementById('result').innerText = predictionText[langCode];
      const voiceLang = (langCode === 'ta') ? 'ta-IN' : (langCode === 'hi') ? 'hi-IN' : 'en-IN';
      speak(predictionText[langCode], voiceLang);
    });
  </script>
</body>
</html>
